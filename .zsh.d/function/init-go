#!/usr/bin/env zsh

export REQUIRED_GO_VERSION=1.12.1
# export GOROOT=$(asdf where golang)
export GOPATH=~/.go.d
export PATH="$GOPATH/bin:$GOROOT/bin:$PATH"

# ----------------------------------------------------------------------
# ### version control ###
get-goenv() {
  case "${OSTYPE}" in
    freebsd* | darwin* | linux*) anyenv install goenv && exec -l zsh ;;
  esac
}
if ! type -p goenv >/dev/null; then get-goenv; fi

# ----------------------------------------------------------------------
get-go-by-asdf() {
  case "${OSTYPE}" in
    freebsd* | darwin* | linux*)
      case $(asdf plugin-list) in *golang*) ;; *) asdf plugin-add golang ;; esac
      asdf install golang $REQUIRED_GO_VERSION
      asdf global golang $REQUIRED_GO_VERSION
      ;;
  esac
}

get-go() {
  case "${OSTYPE}" in
    freebsd* | darwin*) ;;
    linux*)
      if ! type -p goenv >/dev/null; then get-goenv; fi
      goenv install $REQUIRED_GO_VERSION
      set-go
      ;;
  esac
}
if ! type -p go >/dev/null; then get-go; fi

set-go() {
  case "${OSTYPE}" in
    freebsd* | darwin* | linux*)
      goenv global $REQUIRED_GO_VERSION >/dev/null
      ;;
  esac
}

# ----------------------------------------------------------------------
get-global-go-packages() {
  case "${OSTYPE}" in
    freebsd* | darwin* | linux*)
      go get -u golang.org/x/tools/cmd/gopls
      go get -u golang.org/x/tools/cmd/goimports

      # utility
      go get -u github.com/peco/peco/cmd/peco
      go get -u github.com/mattn/qq/cmd/qq
      go get -u github.com/mattn/git-fixauthor
      go get -u github.com/shenwei356/csvtk/csvtk
      go get -u github.com/motemen/ghq
      GO111MODULE=off go get -u github.com/motemen/gore/cmd/gore
      ;;
  esac
}
